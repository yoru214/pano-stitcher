# ğŸ“¸ Pano Stitcher

A simple and lightweight image stitching tool and API for creating panoramas or virtual tours from multiple images.

Supports:
- ğŸ›°ï¸ HTTP and gRPC server (via FastAPI + gRPC)
- ğŸ§© Local CLI stitching without a server
- ğŸª„ Easy deployment to Google Cloud Run

---

## ğŸš€ Installation (Local / Server)

### ğŸ›  Requirements
- Python 3.10+
- Docker
- (Optional for local stitching) `opencv-python-headless`, `pillow`

### ğŸ”§ Steps

```bash
# Clone the repo
cd pano-stitcher

# Build and run the API (HTTP + gRPC)
docker compose up --build
```

- Server will be available at:
  - HTTP: `http://localhost:8000/stitch`
  - gRPC: `localhost:50051`
  - Swagger UI: `http://localhost:8000/docs`

---

## â˜ï¸ Deploy to Google Cloud Run

### ğŸ“¦ Enable required APIs:
- Cloud Run
- Artifact Registry
- Cloud Build

### ğŸ“¤ Build and deploy

```bash
# Build and push container to Google Artifact Registry
gcloud builds submit --tag gcr.io/YOUR_PROJECT_ID/pano-stitcher

# Deploy to Cloud Run
gcloud run deploy pano-stitcher \
  --image gcr.io/YOUR_PROJECT_ID/pano-stitcher \
  --platform managed \
  --allow-unauthenticated \
  --memory 1Gi --port 8000
```

> âœ… Expose port 50051 separately for gRPC if needed, or add gRPC proxy.

---

## ğŸ§ª How to Use

### ğŸ“¡ HTTP API

- `POST /stitch`
- `x-internal-key: dev-secret-key`
- `form-data`: upload `images[]`
- `?format=webp|jpeg`

Swagger UI: `http://localhost:8000/docs`

---

### âš¡ gRPC

- Method: `stitcher.Stitcher/Process`
- Input: `StitchRequest` with `images`, `format`, `key`

Use tools like:
- `grpcurl`
- BloomRPC

You may also use the included Python client:

```bash
python process.py 
```

---

## ğŸ§± Local-Only Mode (No Server)

You can stitch panoramas locally from the command line without using the server.

### ğŸ—‚ Folder Structure

```
images/
â”œâ”€â”€ src/       # source images
â””â”€â”€ output/    # stitched results
```

### ğŸ§ª Run

```bash
python process.py --local
```

You'll be prompted to:
- Choose output filename
- Choose format (`webp` or `jpeg`)

---

## ğŸ§¬ Protobuf Code Generation

Only needed if you modify `stitcher.proto`:

```bash
python -m grpc_tools.protoc \
  -I./app/proto \
  --python_out=./app \
  --grpc_python_out=./app \
  ./app/proto/stitcher.proto
```

Make sure `stitcher_pb2.py` and `stitcher_pb2_grpc.py` are generated inside the `app/` folder.

---

## ğŸ“¦ Required Python Packages (for local mode)

```bash
pip install grpcio grpcio-tools opencv-python-headless pillow
```

---

## ğŸ“ Project Structure

```
pano-stitcher/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ stitcher/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ main.py
â”‚       â”œâ”€â”€ grpc_server.py
â”‚       â”œâ”€â”€ start_servers.py
â”‚       â”œâ”€â”€ process.py
â”‚       â”œâ”€â”€ proto/
â”‚       â”‚   â””â”€â”€ stitcher.proto
â”‚       â”œâ”€â”€ stitcher_pb2.py
â”‚       â”œâ”€â”€ stitcher_pb2_grpc.py
â”‚       â””â”€â”€ images/
â”‚           â”œâ”€â”€ src/
â”‚           â””â”€â”€ output/
```

---

## ğŸ“ License

This project is licensed under the MIT License â€” free for personal and commercial use. See the [LICENSE](LICENSE) file for full terms.
